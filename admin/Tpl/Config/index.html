<tagLib name="lbase"/>
<!DOCTYPE html>
<html lang="zh-cn">
    <head>
        <meta charset="utf-8">
        <title>微信公众平台营销管理系统</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="description" content="">
        <meta name="author" content="">
    <include file='Public:header' />
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="__ROOT__/public/js/html5shiv.js"></script>
    <![endif]-->
</head>

<body>
    <!--nav-->
<include file='Public:nav' />


<div class="container">
    <!--            <ul class="breadcrumb">
                    <li><a href="#">首页</a> <span class="divider">/</span></li>
                    <li><a href="#">Library</a> <span class="divider">/</span></li>
                    <li class="active">Data</li>
                </ul>-->
    <div class="page-header"><h4>系统配置</h4></div>

    <!--<p class="view"><b>功能：</b>管理&nbsp;|&nbsp;添加|&nbsp;添加|&nbsp;添加|&nbsp;添加|&nbsp;添加</p>-->
    <!--    <div class="row">
            <div class="span12">
                <div class="pull-left">
                    <a href="{:U('/'.$module_name)}" class="btn btn-primary">列 表</a>&nbsp;&nbsp;
                    <a href="{:U($module_name.'/add')}" class="btn btn-primary">新 增</a>&nbsp;&nbsp;
                    <a class="btn btn-primary" onclick="history.go(-1);">返 回</a>
                </div>
            </div>
        </div>-->
    <div class="row">
        <div class="span12" style="margin-top:10px;">
            <div class="tabbable">
                <ul class="nav nav-tabs">
                    <li class="active"><a href="#tab1" data-toggle="tab">系统配置</a></li>
                    <li><a href="#tab2" data-toggle="tab">微信回复配置</a></li>
                </ul>
                <div class="tab-content">
                    <div class="tab-pane active" id="tab1">
                        <form class="form-horizontal">
                            <fieldset>
                                <div class="control-group">
                                    <label class="control-label" for="input01">微信通信密钥</label>
                                    <div class="controls">
                                        <input type="text" placeholder="微信通信密钥" class="input-xlarge">
                                        <p class="help-block">与微信公众平台通信token密钥一致</p>
                                    </div>
                                </div>
                            </fieldset>
                        </form>
                    </div>
                    <div class="tab-pane" id="tab2">
                        <p><span>图文列表返回数量：</span><input type="text" size="20" name="count" /></p>
                        <p><span>默认回复文本：</span><input type="text" size="20" name="count" /></p>
                    </div>
                </div>
            </div>
        </div>
        <div class="span12">
            <button class="btn btn-primary" type="button">保存全部</button>
        </div>
    </div>

</div>
</div>

<include file='Public:footer' />
<script type="text/javascript">
    $(function() {
        $('[name=msg_type]').change(function() {
            msg_type_change()
        });

        $('[name=main]').change(function() {
            main_change()
        });


        function main_change() {
            var id = $('[name=main]').val();
            if (id == '0') {
                $('[name=sort]').parent().parent().hide();
            } else {
                $('[name=sort]').parent().parent().show();
            }
        }



        function msg_type_change() {
            var value = $('[name=msg_type]').val();

            switch (value) {
                case "1":
                    $('[name=click_url]').parent().parent().hide();
                    $('#pic_upload').hide();
                    $('[name=main]').parent().parent().hide();
                    $('[name=sort]').parent().parent().hide();
                    break;
                case "2":
                    $('[name=click_url]').parent().parent().show();
                    $('#pic_upload').show();
                    $('[name=main]').parent().parent().hide();
                    $('[name=sort]').parent().parent().hide();
                    break;
                case "3":
                    $('[name=click_url]').parent().parent().show();
                    $('#pic_upload').show();
                    $('[name=main]').parent().parent().show();
//                $('[name=sort]').parent().parent().hide();
                    break;
            }
        }



        $('#save').click(function() {
            contents_editor.sync();
            var data = $('form').serialize();
            $.ajax({
                type: "POST",
                url: app_url + "/{$module_name}/update",
                data: data,
                timeout: 5000,
                dataType: 'json',
                cache: false,
                success: function(data) {
                    success(data);
                },
                error: function() {
                    error();
                }
            });

        });


        $('#pop').ajaxStart(function() {
            $('#pop').html('<div class="alert alert-info"><button type="button" class="close" data-dismiss="alert">×</button>数据请求中，请稍候...</div>')
                    .fadeIn("slow");
        });

        function success(data) {
            if (data.data == 1) {
                $('#pop').html('<div class="alert alert-success"><button type="button" class="close" data-dismiss="alert">×</button>信息修改成功！</div>')
                        .fadeIn("slow")
                        .fadeOut(5000);
            } else {
                $('#pop').html('<div class="alert alert-error"><button type="button" class="close" data-dismiss="alert">×</button>信息修改失败或者信息并无改变！</div>')
                        .fadeIn("slow")
                        .fadeOut(5000);
            }
        }

        function error() {
            $('#pop').html('<div class="alert alert-error"><button type="button" class="close" data-dismiss="alert">×</button>远程服务器请求失败！</div>')
                    .fadeIn("slow")
                    .fadeOut(5000);
        }
    });
</script>
</body>
</html>
